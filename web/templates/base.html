<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Chat with Your Documents{% endblock %}</title>
    <link id="favicon" rel="icon" type="image/x-icon" href="static/images/svg.ico">

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Optionally, customize Tailwind theme before loading (see next section) -->
    {% block tailwind_config %}
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ["Lexend", "-apple-system", "BlinkMacSystemFont", "Segoe UI", "Helvetica", "Arial", "sans-serif", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"],
            },
            colors: {
              darkish: "#3E3E3E",
              darkBlue: "#14142B",
              lightBlue: "#F9F9FF",
              readablePrimary: "#111111",
              readableSecondary: "rgba(73, 56, 81, 0.53)"
            }
          }
        }
      }
    </script>
    {% endblock %}

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- Markdown -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">

    <!-- Custom global CSS -->
    <link rel="stylesheet" href="{{ url_for('static', path='css/global.css') }}">

    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen flex flex-col transition-colors duration-200">
    <!-- Navigation -->
    <nav class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 transition-colors duration-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <a href="/" class="flex items-center">
                            <img src="{{ url_for('static', path='brand_logo.svg') }}" alt="Brain Drive" class="h-8 w-auto">
                        </a>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="/" class="inline-flex items-center px-1 pt-1 text-sm font-medium text-gray-900 border-b-2 {% if request.url.path == '/' %}border-blue-500{% else %}border-transparent hover:border-gray-300{% endif %}">
                            <i data-lucide="home" class="h-4 w-4 mr-1"></i>
                            Dashboard
                        </a>
                        <a href="/chat" class="inline-flex items-center px-1 pt-1 text-sm font-medium text-gray-500 border-b-2 {% if '/chat' in request.url.path %}border-blue-500 text-gray-900{% else %}border-transparent hover:border-gray-300 hover:text-gray-700{% endif %}">
                            <i data-lucide="message-circle" class="h-4 w-4 mr-1"></i>
                            Chat
                        </a>
                        <a href="/search" class="inline-flex items-center px-1 pt-1 text-sm font-medium text-gray-500 border-b-2 {% if '/search' in request.url.path %}border-blue-500 text-gray-900{% else %}border-transparent hover:border-gray-300 hover:text-gray-700{% endif %}">
                            <i data-lucide="search" class="h-4 w-4 mr-1"></i>
                            Search
                        </a>
                    </div>
                </div>
                <div class="flex items-center">
                    <button id="theme-toggle" class="p-2 text-gray-400 hover:text-gray-500 dark:text-gray-300 dark:hover:text-gray-200 transition-colors duration-200">
                        <i data-lucide="sun" class="h-5 w-5 dark:hidden"></i>
                        <i data-lucide="moon" class="h-5 w-5 hidden dark:block"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1">
        {% block content %}{% endblock %}
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 flex items-center space-x-3">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
            <span class="text-gray-700">Processing...</span>
        </div>
    </div>

    <!-- Base JavaScript -->
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global utilities
        window.utils = {
            // Show toast notification
            showToast(message, type = 'info') {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                const bgColor = {
                    success: 'bg-green-500',
                    error: 'bg-red-500',
                    warning: 'bg-yellow-500',
                    info: 'bg-blue-500'
                }[type] || 'bg-blue-500';

                toast.className = `${bgColor} text-white px-4 py-2 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full opacity-0`;
                toast.textContent = message;

                container.appendChild(toast);

                // Animate in
                setTimeout(() => {
                    toast.classList.remove('translate-x-full', 'opacity-0');
                }, 10);

                // Remove after 3 seconds
                setTimeout(() => {
                    toast.classList.add('translate-x-full', 'opacity-0');
                    setTimeout(() => container.removeChild(toast), 300);
                }, 3000);
            },

            // Show/hide loading overlay
            showLoading() {
                document.getElementById('loading-overlay').classList.remove('hidden');
            },

            hideLoading() {
                document.getElementById('loading-overlay').classList.add('hidden');
            },

            // Format date
            formatDate(dateString) {
                return new Date(dateString).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            },

            // API request wrapper
            async apiRequest(url, options = {}) {
                try {
                    const response = await fetch(url, {
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers
                        },
                        ...options
                    });

                    if (!response.ok) {
                        const error = await response.json().catch(() => ({ detail: 'An error occurred' }));
                        throw new Error(error.detail || 'An error occurred');
                    }

                    return await response.json();
                } catch (error) {
                    this.showToast(error.message, 'error');
                    throw error;
                }
            }
        };

        // Theme toggle (optional enhancement)
        // document.getElementById('theme-toggle').addEventListener('click', function() {
        //     // Basic theme toggle - can be expanded later
        //     const icon = this.querySelector('i');
        //     if (icon.getAttribute('data-lucide') === 'sun') {
        //         icon.setAttribute('data-lucide', 'moon');
        //     } else {
        //         icon.setAttribute('data-lucide', 'sun');
        //     }
        //     lucide.createIcons();
        // });
        (function() {
            const themeToggle = document.getElementById('theme-toggle');
            const html = document.documentElement;

            // Check for saved theme preference or default to 'light'
            const currentTheme = localStorage.getItem('theme') || 'light';

            // Apply the current theme
            if (currentTheme === 'dark') {
                html.classList.add('dark');
            } else {
                html.classList.remove('dark');
            }

            // Theme toggle event listener
            themeToggle.addEventListener('click', function() {
                if (html.classList.contains('dark')) {
                    html.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                } else {
                    html.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                }
            });
        })();
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>