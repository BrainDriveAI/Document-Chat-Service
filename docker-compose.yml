services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: chat-with-docs-app
    env_file:
      - .env
    ports:
      - "8000:8000"
    volumes:
      # Mount data directory for persistence
      # - ./data:/app/data
      # Mount uploads directory
      # - ./uploads:/app/uploads
      # Mount logs directory
      # - ./logs:/app/logs
      - ../../persistent/chat_docs/data:/app/data
      - ../../persistent/chat_docs/uploads:/app/uploads
      - ../../persistent/chat_docs/logs:/app/logs
    environment:
      # If .env is present, it will override these.
      # Default values are provided if the variables are not set in the .env file or environment.
      - LLM_PROVIDER=${LLM_PROVIDER:-ollama}
      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER:-ollama}
      - ENABLE_CONTEXTUAL_RETRIEVAL=${ENABLE_CONTEXTUAL_RETRIEVAL:-true}
      - OLLAMA_CONTEXTUAL_LLM_BASE_URL=${OLLAMA_CONTEXTUAL_LLM_BASE_URL:-http://host.docker.internal:11434}
      - OLLAMA_CONTEXTUAL_LLM_MODEL=${OLLAMA_CONTEXTUAL_LLM_MODEL:-gemma3:1b}
      - OLLAMA_LLM_BASE_URL=${OLLAMA_LLM_BASE_URL:-http://host.docker.internal:11434}
      - OLLAMA_LLM_MODEL=${OLLAMA_LLM_MODEL:-gemma3:1b}
      - OLLAMA_EMBEDDING_BASE_URL=${OLLAMA_EMBEDDING_BASE_URL:-http://host.docker.internal:11434}
      - OLLAMA_EMBEDDING_MODEL=${OLLAMA_EMBEDDING_MODEL:-mxbai-embed-large}
      - DOCUMENT_PROCESSOR_API_URL=${DOCUMENT_PROCESSOR_API_URL:-http://host.docker.internal:8080/documents/}
      - DOCUMENT_PROCESSOR_API_KEY=${DOCUMENT_PROCESSOR_API_KEY:-default_api_key}
      - DOCUMENT_PROCESSOR_TIMEOUT=${DOCUMENT_PROCESSOR_TIMEOUT:-600}
      - DOCUMENT_PROCESSOR_MAX_RETRIES=${DOCUMENT_PROCESSOR_MAX_RETRIES:-3}
      - INITIALIZE_TEST_COLLECTION=${INITIALIZE_TEST_COLLECTION:-false}
      - EVALUATION_TEST_COLLECTION_ID=${EVALUATION_TEST_COLLECTION_ID:-eval-test-collection-00000000-0000-0000-0000-000000000001}
      - EVALUATION_TEST_COLLECTION_NAME=${EVALUATION_TEST_COLLECTION_NAME:-evaluation_test_collection}
      - EVALUATION_TEST_DOCS_DIR=${EVALUATION_TEST_DOCS_DIR:-evaluation_test_docs}
      - CHROMA_TELEMETRY=0
      - SCARF_NO_ANALYTICS=true
      - DO_NOT_TRACK=true
      - ANONYMIZED_TELEMETRY=false
    restart: unless-stopped
