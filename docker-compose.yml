version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: chat-with-docs-app
    env_file:
      - .env
    ports:
      - "8000:8000"
    volumes:
      # Mount data directory for persistence
      # - ./data:/app/data
      # Mount uploads directory
      # - ./uploads:/app/uploads
      # Mount logs directory
      # - ./logs:/app/logs
      - ../../persistent/chat_docs/data:/app/data
      - ../../persistent/chat_docs/uploads:/app/uploads
      - ../../persistent/chat_docs/logs:/app/logs
    environment:
      - LLM_PROVIDER=${LLM_PROVIDER}
      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}
      - ENABLE_CONTEXTUAL_RETRIEVAL=${ENABLE_CONTEXTUAL_RETRIEVAL}
      - OLLAMA_CONTEXTUAL_LLM_BASE_URL=${OLLAMA_CONTEXTUAL_LLM_BASE_URL}
      - OLLAMA_CONTEXTUAL_LLM_MODEL=${OLLAMA_CONTEXTUAL_LLM_MODEL}
      - OLLAMA_LLM_BASE_URL=${OLLAMA_LLM_BASE_URL}
      - OLLAMA_LLM_MODEL=${OLLAMA_LLM_MODEL}
      - OLLAMA_EMBEDDING_BASE_URL=${OLLAMA_EMBEDDING_BASE_URL}
      - OLLAMA_EMBEDDING_MODEL=${OLLAMA_EMBEDDING_MODEL}
      - DOCUMENT_PROCESSOR_API_URL=${DOCUMENT_PROCESSOR_API_URL}
      - DOCUMENT_PROCESSOR_TIMEOUT=${DOCUMENT_PROCESSOR_TIMEOUT}
      - DOCUMENT_PROCESSOR_MAX_RETRIES=${DOCUMENT_PROCESSOR_MAX_RETRIES}
    restart: unless-stopped
  
